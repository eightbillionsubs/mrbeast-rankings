<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MrBeast 2026 Video Rankings Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --bg-expanded: #0e0e14;
            --accent-gold: #ffd93d;
            --accent-red: #ff6b6b;
            --accent-green: #6bffb8;
            --accent-blue: #6bb3ff;
            --accent-purple: #a78bfa;
            --accent-orange: #ffb347;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-subtle: rgba(255,255,255,0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: 30px 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: clamp(1.6rem, 4vw, 2.4rem);
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #fff 0%, #c0c0c0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        /* File Drop Zone */
        .drop-zone {
            border: 2px dashed var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--accent-blue);
            background: rgba(107, 179, 255, 0.05);
        }

        .drop-zone p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .drop-zone input {
            display: none;
        }

        .data-status {
            font-size: 0.8rem;
            color: var(--accent-green);
            margin-top: 8px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent-blue);
            color: #000;
            border-color: var(--accent-blue);
        }

        .tab.active.views { background: var(--accent-green); }
        .tab.active.ctr { background: var(--accent-gold); }
        .tab.active.avd { background: var(--accent-purple); }
        .tab.active.controversy { background: var(--accent-red); }

        /* Page Content */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .page-header .icon {
            font-size: 1.4rem;
        }

        .page-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .page-header .desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-left: auto;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
            padding: 12px 16px;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        /* Video List */
        .video-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .video-row {
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .video-row:hover {
            border-color: var(--border-subtle);
        }

        .video-row.bottom {
            background: rgba(255, 107, 107, 0.08);
            border-color: rgba(255, 107, 107, 0.15);
        }

        .video-main {
            display: grid;
            grid-template-columns: 38px 1fr auto 36px;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            cursor: pointer;
        }

        .rank-badge {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .rank-badge.gold { background: linear-gradient(135deg, #ffd93d 0%, #ffb347 100%); color: #000; }
        .rank-badge.silver { background: linear-gradient(135deg, #e8e8e8 0%, #b8b8b8 100%); color: #000; }
        .rank-badge.bronze { background: linear-gradient(135deg, #cd7f32 0%, #a0522d 100%); color: #fff; }
        .rank-badge.top { background: rgba(107, 255, 184, 0.15); color: var(--accent-green); }
        .rank-badge.mid { background: rgba(255, 255, 255, 0.08); color: var(--text-secondary); }
        .rank-badge.bottom { background: rgba(255, 107, 107, 0.2); color: var(--accent-red); }
        .rank-badge.controversial { background: rgba(167, 139, 250, 0.15); color: var(--accent-purple); }

        .video-title {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stats-pills {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .pill {
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            white-space: nowrap;
        }

        .pill.avg { background: rgba(255, 255, 255, 0.08); color: var(--text-secondary); }
        .pill.std { background: rgba(167, 139, 250, 0.12); color: var(--accent-purple); }
        .pill.range { background: rgba(107, 179, 255, 0.12); color: var(--accent-blue); }

        .expand-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: rgba(255,255,255,0.05);
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }

        .expand-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .expand-btn.expanded {
            transform: rotate(90deg);
        }

        /* Expanded Details */
        .video-details {
            display: none;
            padding: 0 14px 14px 14px;
            border-top: 1px solid var(--border-subtle);
            margin-top: 0;
        }

        .video-details.expanded {
            display: block;
        }

        .voter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }

        .voter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-expanded);
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .voter-name {
            color: var(--text-secondary);
        }

        .voter-rank {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Predictions Section */
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
        }

        .prediction-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 16px;
            border-left: 3px solid var(--accent-blue);
        }

        .prediction-card h4 {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
        }

        .prediction-card .value {
            font-size: 1.4rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .prediction-card .desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Responsive */
        @media (max-width: 700px) {
            .video-main {
                grid-template-columns: 34px 1fr 28px;
            }
            .stats-pills {
                display: none;
            }
            .video-title {
                white-space: normal;
            }
            .page-header .desc {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>MrBeast 2026 Video Rankings</h1>
            <p class="subtitle">Team predictions for main channel performance</p>
        </header>

        <!-- File Drop Zone -->
        <div class="drop-zone" id="dropZone">
            <p>üìÅ Drop updated CSV here or click to upload</p>
            <input type="file" id="fileInput" accept=".csv">
            <div class="data-status" id="dataStatus"></div>
        </div>

        <!-- Predictions Summary -->
        <div class="predictions-grid" id="predictionsGrid"></div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab views active" data-page="views">üìä Expected Views</button>
            <button class="tab ctr" data-page="ctr">üëÜ CTR</button>
            <button class="tab avd" data-page="avd">‚è±Ô∏è AVD</button>
            <button class="tab controversy" data-page="controversy">‚ö° Controversy</button>
        </div>

        <!-- Pages -->
        <div class="page active" id="views-page">
            <div class="page-header">
                <span class="icon">üìä</span>
                <h2>Expected Views Ranking</h2>
                <span class="desc">Ranked by average predicted 90-day view count</span>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background: var(--text-secondary)"></div> Avg = Team average rank</div>
                <div class="legend-item"><div class="legend-dot" style="background: var(--accent-purple)"></div> œÉ = Standard deviation</div>
            </div>
            <div class="video-list" id="views-list"></div>
        </div>

        <div class="page" id="ctr-page">
            <div class="page-header">
                <span class="icon">üëÜ</span>
                <h2>Click-Through Rate Ranking</h2>
                <span class="desc">Ranked by predicted thumbnail CTR</span>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background: var(--text-secondary)"></div> Avg = Team average rank</div>
                <div class="legend-item"><div class="legend-dot" style="background: var(--accent-purple)"></div> œÉ = Standard deviation</div>
            </div>
            <div class="video-list" id="ctr-list"></div>
        </div>

        <div class="page" id="avd-page">
            <div class="page-header">
                <span class="icon">‚è±Ô∏è</span>
                <h2>Average View Duration Ranking</h2>
                <span class="desc">Ranked by predicted watch time</span>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background: var(--text-secondary)"></div> Avg = Team average rank</div>
                <div class="legend-item"><div class="legend-dot" style="background: var(--accent-purple)"></div> œÉ = Standard deviation</div>
            </div>
            <div class="video-list" id="avd-list"></div>
        </div>

        <div class="page" id="controversy-page">
            <div class="page-header">
                <span class="icon">‚ö°</span>
                <h2>Most Controversial (Views)</h2>
                <span class="desc">Ranked by standard deviation of view rankings</span>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot" style="background: var(--accent-purple)"></div> œÉ = Higher = more disagreement</div>
                <div class="legend-item"><div class="legend-dot" style="background: var(--accent-blue)"></div> Range = Min to Max rank</div>
            </div>
            <div class="video-list" id="controversy-list"></div>
        </div>
    </div>

    <script>
        // Global data store
        let surveyData = null;

        // Column ranges (0-indexed, after header row)
        const COLS = {
            name: 3,
            viewsStart: 4,
            viewsEnd: 32,
            ctrStart: 33,
            ctrEnd: 61,
            avdStart: 62,
            avdEnd: 90,
            predictions: [91, 92, 93, 94]
        };

        // Parse CSV
        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = parseCSVLine(lines[1]); // Row 2 has column names
            const data = [];
            
            for (let i = 2; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length > 4) {
                    data.push(values);
                }
            }
            
            return { headers, data };
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Extract video data for a specific ranking type
        function extractRankings(headers, data, startCol, endCol) {
            const videos = [];
            const numVideos = endCol - startCol + 1;
            
            for (let i = 0; i < numVideos; i++) {
                const colIdx = startCol + i;
                let videoName = headers[colIdx] || `Video ${i + 1}`;
                // Remove .1, .2 suffixes from duplicate column names
                videoName = videoName.replace(/\.\d+$/, '');
                
                const rankings = [];
                const voters = [];
                
                data.forEach(row => {
                    const voterName = row[COLS.name];
                    const rank = parseInt(row[colIdx]);
                    if (!isNaN(rank)) {
                        rankings.push(rank);
                        voters.push({ name: voterName, rank: rank });
                    }
                });
                
                if (rankings.length > 0) {
                    const avg = rankings.reduce((a, b) => a + b, 0) / rankings.length;
                    const std = Math.sqrt(rankings.map(r => Math.pow(r - avg, 2)).reduce((a, b) => a + b, 0) / rankings.length);
                    const min = Math.min(...rankings);
                    const max = Math.max(...rankings);
                    
                    videos.push({
                        name: videoName,
                        avg: avg,
                        std: std,
                        min: min,
                        max: max,
                        range: max - min,
                        voters: voters
                    });
                }
            }
            
            return videos;
        }

        // Extract predictions
        function extractPredictions(data) {
            const normalize = (val) => {
                const num = parseFloat(val);
                return num > 10000 ? num / 1000000 : num;
            };
            
            const topViews = [];
            const bottomViews = [];
            const mainSubs = [];
            const gamingSubs = [];
            
            data.forEach(row => {
                topViews.push(normalize(row[COLS.predictions[0]]));
                bottomViews.push(normalize(row[COLS.predictions[1]]));
                mainSubs.push(normalize(row[COLS.predictions[2]]));
                gamingSubs.push(normalize(row[COLS.predictions[3]]));
            });
            
            const median = arr => {
                const sorted = [...arr].filter(n => !isNaN(n)).sort((a, b) => a - b);
                const mid = Math.floor(sorted.length / 2);
                return sorted.length % 2 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
            };
            
            return {
                topViews: median(topViews),
                bottomViews: median(bottomViews),
                mainSubs: median(mainSubs),
                gamingSubs: median(gamingSubs)
            };
        }

        // Get rank badge class
        function getRankBadgeClass(rank, total, isControversy = false) {
            if (isControversy) return 'controversial';
            if (rank === 1) return 'gold';
            if (rank === 2) return 'silver';
            if (rank === 3) return 'bronze';
            if (rank <= 10) return 'top';
            if (rank > total - 5) return 'bottom';
            return 'mid';
        }

        // Render video list
        function renderVideoList(containerId, videos, sortBy = 'avg', isControversy = false) {
            const container = document.getElementById(containerId);
            const sorted = [...videos].sort((a, b) => isControversy ? b.std - a.std : a[sortBy] - b[sortBy]);
            const total = sorted.length;
            
            container.innerHTML = sorted.map((video, idx) => {
                const rank = idx + 1;
                const badgeClass = getRankBadgeClass(rank, total, isControversy);
                const isBottom = !isControversy && rank > total - 5;
                const rowId = `${containerId}-${idx}`;
                
                return `
                    <div class="video-row ${isBottom ? 'bottom' : ''}">
                        <div class="video-main" onclick="toggleExpand('${rowId}')">
                            <div class="rank-badge ${badgeClass}">${rank}</div>
                            <div class="video-title">${video.name}</div>
                            <div class="stats-pills">
                                ${isControversy 
                                    ? `<span class="pill std">œÉ: ${video.std.toFixed(2)}</span>
                                       <span class="pill range">${video.min}‚Üí${video.max}</span>`
                                    : `<span class="pill avg">Avg: ${video.avg.toFixed(1)}</span>
                                       <span class="pill std">œÉ: ${video.std.toFixed(1)}</span>`
                                }
                            </div>
                            <button class="expand-btn" id="btn-${rowId}">‚ñ∂</button>
                        </div>
                        <div class="video-details" id="details-${rowId}">
                            <div class="voter-grid">
                                ${video.voters.map(v => `
                                    <div class="voter-item">
                                        <span class="voter-name">${v.name}</span>
                                        <span class="voter-rank">#${v.rank}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render predictions
        function renderPredictions(predictions) {
            const container = document.getElementById('predictionsGrid');
            container.innerHTML = `
                <div class="prediction-card" style="border-color: var(--accent-green)">
                    <h4>Best Video (90-day)</h4>
                    <div class="value">${predictions.topViews.toFixed(0)}M</div>
                    <div class="desc">views</div>
                </div>
                <div class="prediction-card" style="border-color: var(--accent-red)">
                    <h4>Worst Video (90-day)</h4>
                    <div class="value">${predictions.bottomViews.toFixed(0)}M</div>
                    <div class="desc">views</div>
                </div>
                <div class="prediction-card" style="border-color: var(--accent-gold)">
                    <h4>Main Channel (Dec 31)</h4>
                    <div class="value">${predictions.mainSubs.toFixed(0)}M</div>
                    <div class="desc">subscribers</div>
                </div>
                <div class="prediction-card" style="border-color: var(--accent-purple)">
                    <h4>Gaming Channel (Dec 31)</h4>
                    <div class="value">${predictions.gamingSubs.toFixed(0)}M</div>
                    <div class="desc">subscribers</div>
                </div>
            `;
        }

        // Toggle expand
        function toggleExpand(rowId) {
            const details = document.getElementById(`details-${rowId}`);
            const btn = document.getElementById(`btn-${rowId}`);
            
            details.classList.toggle('expanded');
            btn.classList.toggle('expanded');
        }

        // Process and render all data
        function processData(csvText) {
            const { headers, data } = parseCSV(csvText);
            
            // Update status
            document.getElementById('dataStatus').textContent = `‚úì Loaded ${data.length} responses`;
            
            // Extract rankings for each type
            const viewsData = extractRankings(headers, data, COLS.viewsStart, COLS.viewsEnd);
            const ctrData = extractRankings(headers, data, COLS.ctrStart, COLS.ctrEnd);
            const avdData = extractRankings(headers, data, COLS.avdStart, COLS.avdEnd);
            const predictions = extractPredictions(data);
            
            // Render everything
            renderVideoList('views-list', viewsData, 'avg', false);
            renderVideoList('ctr-list', ctrData, 'avg', false);
            renderVideoList('avd-list', avdData, 'avg', false);
            renderVideoList('controversy-list', viewsData, 'std', true);
            renderPredictions(predictions);
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.page}-page`).classList.add('active');
            });
        });

        // File handling
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.csv')) {
                loadFile(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                loadFile(file);
            }
        });

        function loadFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                processData(e.target.result);
            };
            reader.readAsText(file);
        }

        // Try to auto-load data.csv on page load
        async function init() {
            try {
                const response = await fetch('data.csv');
                if (response.ok) {
                    const text = await response.text();
                    processData(text);
                }
            } catch (e) {
                document.getElementById('dataStatus').textContent = 'Drop a CSV file to get started';
            }
        }

        init();
    </script>
</body>
</html>
